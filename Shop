using System;
using System.Linq;
using System.Collections.Generic;

namespace Shop
{
    class Program
    {
        private static void Main()
        {
            int sellerIndex = 0, playerIndex = 1;
            Player player = new Player(500);
            Person[] persons =
{
                new Seller(),
                new Player()
            };
            for (int i = 0; i < persons.Length; i++)
            {
                persons[i].FillingInventory();
            }

            while (true)
            {
                player.ShowBalance();
                Console.WriteLine("Комманды:" +
                "\n1)Помотреть товары продавца." +
                "\n2)Купить товар." +
                "\n3)Посмотреть свой инвентарь.");
                Console.Write("\nОтвет: ");

                switch (Convert.ToInt32(Console.ReadLine()))
                {
                    case 1:
                        persons[sellerIndex].ShowInventory("продавца");
                        break;
                    case 2:
                        PurchaseOfGoods(persons, sellerIndex, playerIndex, player);
                        break;
                    case 3:
                        persons[playerIndex].ShowInventory("игрока");
                        break;
                }

                Console.ReadKey();
                Console.Clear();
            }
        }

        private static void PurchaseOfGoods(Person[] persons, int sellerIndex, int playerIndex, Player player)
        {
            bool success = true;
            Goods[] tempGoodsOfPlayer = new Goods[persons[playerIndex].Goods.Length + 1];

            persons[sellerIndex].ShowInventory("продавца");
            Console.Write("\nВведите товар, который хотите купить: ");
            int productNumber = Convert.ToInt32(Console.ReadLine()) - 1;

            for (int i = 0; i < persons[sellerIndex].Goods.Length; i++)
            {
                if (persons[sellerIndex].Goods[productNumber].Product == persons[sellerIndex].Goods[i].Product)
                {
                    success = player.MoneyTransfer(persons[sellerIndex].Goods[productNumber].ProductPrice, success);
                    if(success == true)
                    {
                        tempGoodsOfPlayer[tempGoodsOfPlayer.Length - 1] = new Goods(persons[sellerIndex].Goods[productNumber].Product);
                        persons[playerIndex].AddingItemToInventory(tempGoodsOfPlayer);
                        persons[sellerIndex].RemoveItemFromInventory(productNumber);
                    }
                }
            }
        }
    }

    class Goods
    {
        public string Product { get; private set; }
        public int ProductPrice { get; private set; }
        public Goods(string product, int productPrice = 0)
        {
            Product = product;
            ProductPrice = productPrice;
        }
    }

    abstract class Person
    {
        public Goods[] Goods { get; protected set; }

        public void ShowInventory(string inventoryOwner)
        {
            Console.WriteLine($"\nИнвентарь {inventoryOwner}:");
            for (int i = 0; i < Goods.Length; i++)
            {
                if(Goods[i].ProductPrice != 0)
                {
                    Console.WriteLine($"{i + 1}){Goods[i].Product} - {Goods[i].ProductPrice}");
                }
                else
                {
                    Console.WriteLine($"{i + 1}){Goods[i].Product}");
                }
            }
        }

        public void AddingItemToInventory(Goods[] tempGoodsOfPlayer)
        {
            for (int i = 0; i < Goods.Length; i++)
            {
                tempGoodsOfPlayer[i] = Goods[i];
            }
            Goods = tempGoodsOfPlayer;
        }

        public void RemoveItemFromInventory(int productNumber)
        {
            List<Goods> tempGoodsOfSeller = Goods.ToList();
            tempGoodsOfSeller.RemoveAt(productNumber);
            Goods = tempGoodsOfSeller.ToArray();
        }

        public abstract void FillingInventory();
    }

    class Seller : Person
    {
        public override void FillingInventory()
        {
            Goods[] goods =
            {
                new Goods("Алмазный меч", 200),
                new Goods("Золотой меч", 100),
                new Goods("Лук", 50),
                new Goods("Алмазная броня", 300),
                new Goods("Топор", 75)
            };
            Goods = goods;
        }
    }

    class Player : Person
    {
        private int _money;
        public Player(int money = 0)
        {
            _money = money;
        }

        public override void FillingInventory()
        {
            Goods[] goods = new Goods[0];
            Goods = goods;
        }

        public void ShowBalance()
        {
            Console.SetCursorPosition(0, 20);
            Console.WriteLine($"Ваш баланс - {_money}.");
            Console.SetCursorPosition(0, 0);
        }
        
        public bool MoneyTransfer(int productPrice, bool success)
        {
            if(_money < productPrice)
            {
                Console.WriteLine("\nНе достаточно средств!");
                success = false;
            }
            else
            {
                _money -= productPrice;
            }
            return success;
        }
    }
}
